[CONTEXTO T√âCNICO - ERP AGENT MVP - FASE 2]

O sistema foi recentemente **refatorado** para uma arquitetura modular e conta com funcionalidades avan√ßadas de CRM e Auditoria.

### 1. Arquitetura do Backend (FastAPI Modular)
O `main.py` agora √© limpo. A l√≥gica est√° dividida em `backend/routers/`:
* `auth.py`: Login/Registro.
* `users.py`: CRUD de usu√°rios e permiss√µes.
* `customers.py`: Clientes, Timeline e L√≥gica de Neg√≥cio.
* `feed.py`: Feed de not√≠cias e Notifica√ß√µes.
* **`websockets.py`**: Endpoint `/ws` para Real-Time.
* **`connection_manager.py`**: Gerencia conex√µes ativas de socket.

### 2. Banco de Dados (Novas Tabelas)
* **UserSupervisor:** Tabela de liga√ß√£o (Many-to-Many) para hierarquia flex√≠vel.
* **AuditLog:** Registra altera√ß√µes (JSON `changes`, `action`, `user_id`).
* **CustomerNote:** Suporta tipos `message` ou `task` (com status e timestamps).
* **FeedItem:** Possui campo `visibility` ('public', 'admin_manager').

### 3. Estado Atual do Real-Time (WebSockets)
* **Backend:** O `connection_manager` e a rota `/ws` est√£o implementados e logando conex√µes no terminal ("WS Conectado").
* **Frontend (`Layout.tsx`):** Possui l√≥gica de conex√£o e reconex√£o autom√°tica.
* **Frontend (`CustomerForm.tsx`):** Possui `window.addEventListener('erp-notification')` para atualizar o chat.
* **üî¥ PROBLEMA ATUAL (DEBUG NECESS√ÅRIO):**
    * O sistema de notifica√ß√µes via WebSocket est√° implementado, mas o usu√°rio relata que **o sininho e as mensagens s√≥ aparecem ao recarregar a p√°gina (F5)**.
    * O evento real-time parece n√£o estar disparando a re-renderiza√ß√£o do React ou a conex√£o est√° caindo silenciosamente.
    * O c√≥digo do `Layout.tsx` foi revisado recentemente para corrigir erros de sintaxe (TypeScript), mas o comportamento persiste.

### 4. Pr√≥ximos Passos (Prioridade):
1.  **Debuggar o WebSocket:** Descobrir por que a notifica√ß√£o n√£o atualiza o estado do React instantaneamente (verificar `useEffect` ou despachos de evento).
2.  **Iniciar Fase 2 (Produtos):** Ap√≥s corrigir o socket, iniciar o m√≥dulo de Cadastro de Produtos (`Product` e `Service`).

Use este contexto para corrigir o bug do Real-Time e prosseguir.